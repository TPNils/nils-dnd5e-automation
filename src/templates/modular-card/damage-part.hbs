<div class="{{@root.moduleName}}-damage">
  <div class="{{@root.moduleName}}-flavor">
    {{#if @root.data.calc$.roll.evaluated}}
      {{ localize (nacConcat "DND5E." (nacCapitalize @root.data.mode)) }}
    {{/if}}
  </div>
  <div class="{{@root.moduleName}}-roll-wrapper">
    {{#if @root.data.calc$.roll.evaluated}}
      <div>
        {{> modules/nils-automated-compendium/templates/roll/roll.hbs 
          roll=@root.data.calc$.roll
          overrideFormula=@root.data.calc$.displayFormula
        }}
      </div>
    {{else}}
      <div class="{{@root.moduleName}}-bonus-container">
        <button data-action="item-damage" class="{{@root.moduleName}}-item-damage" {{#nacMisPerm (nacConcat "OwnerUuid:" @root.data.calc$.actorUuid)}}disabled{{/nacMisPerm}}>
          {{#if (eq @root.data.mode 'critical')}}
            {{localize "DND5E.Critical"}}
          {{else}}
            {{localize @root.data.calc$.label}}
          {{/if}}
        </button>
        
        {{#if (and (eq @root.data.phase "bonus-input") (nacPerm (nacConcat "OwnerUuid:" @root.data.calc$.actorUuid)) )}}
          <input class="{{@root.moduleName}}-bonus" placeholder="{{localize "DND5E.Bonus"}}: {{localize 'DND5E.RollExample'}}" type="text" value="{{@root.data.userBonus.formula}}" data-action="item-damage-bonus" {{#nacMisPerm (nacConcat "OwnerUuid:" @root.data.calc$.actorUuid)}}disabled{{/nacMisPerm}}/>
        {{/if}}
      </div>
    {{/if}}
    {{#nacPerm (nacConcat "OwnerUuid:" @root.data.calc$.actorUuid)}}
      <div class="overlay">
        <div class="left">
          <button data-action="item-damage-mode-minus" class="{{@root.moduleName}}-mode-minus" {{#if (eq @root.data.mode 'normal')}}disabled{{/if}}><i class="fas fa-minus"></i></button>
        </div>
        <div class="middel"></div>
        <div class="right">
          {{#if @root.data.calc$.versatileBaseRoll}}
            <button data-action="item-damage-source-toggle" class="damage-source-toggle source-{{@root.data.source}}">
              <i class="fas fa-hand-holding hand-1" data-fa-transform="rotate-90"></i>
              <i class="fas fa-hand-holding hand-2" data-fa-transform="rotate-90"></i>
            </button>
          {{/if}}
          <button data-action="item-damage-mode-plus" class="{{@root.moduleName}}-mode-plus" {{#if (eq @root.data.mode 'critical')}}disabled{{/if}}><i class="fas fa-plus"></i></button>
        </div>
      </div>
    {{/nacPerm}}
  </div>
</div>